/* ors 0.8.0 - https://github.com/passpill-io/ors */
!function(n,t){"function"==typeof define&&define.amd?define(["exports","ors"],t):"object"==typeof exports?module.exports=t():n.ors=t()}(this,function(){"use strict";var n=[];function t(){let t;for(;t=n.shift();)t()}let e=0,i=new WeakMap;function o(n,t){i=new WeakMap;let o=c(n);return o.__.rootName=(t||{}).name||"os"+ ++e,o}var r;if("undefined"!=typeof window&&window.setImmediate){let n=!1;r=function(){n||(n=window.setImmediate(function(){n=!1,t()}))}}else if("undefined"!=typeof window&&window.addEventListener){let n=window.origin;n&&"null"!==n||(n="*"),window.addEventListener("message",function(n){"now"===n.data&&t()}),r=window.postMessage.bind(window,"now",n)}else r=function(){process.nextTick(t)};var s=function(t){return n.push(t),r(),1};function c(n){return l(n)?n:_(n)?n:f(n,!0)}function f(n,t){let e={parents:new Set,clbks:[],timer:!1,dirty:!1},i=p(n);t?y(n,function(t){i[t]=c(n[t]),_(i[t])&&i[t].__.parents.add(e)}):i=function(n){if(n.slice)return n.slice();let t={};for(let e in n)t[e]=n[e];return t}(n);let o=Object.assign({__:e},a),r=new Proxy(i,o);return e.setDirty=function(){e.dirty||(e.dirty=!0,w(r)?function(n){n.__.timer||(n.__.timer=s(()=>{delete n.__.timer,y(t=n,function(n,e){if(h(e)){let i=function n(t){let e=f(p(t));return e.__.init=!0,y(t,function(i,o){if(h(o)){let r=n(o);u(o,r,t,e),e[i]=r,r.emitChange(r)}else e[i]=o}),delete t.__.dirty,delete e.__.init,e}(e);u(e,i,t,t),t[n]=i,i.emitChange(i)}}),t.__.dirty=!1,n.emitChange(n)}));var t}(r):e.parents.forEach(function(n){n.setDirty()}))},e.getAscendancy=function(n){return n.add(r),e.parents.forEach(t=>{t.getAscendancy(n)}),n},r}function u(n,t,e,i){let o=!1;_(n)&&(n.__.parents.delete(e.__),o=!0),_(t)&&(t.__.parents.add(i.__),o&&(t.__.clbks=n.__.clbks.slice()))}var a={set:function(n,t,e){return"function"==typeof e?(o.warn("Adding functions to a oS is not allowed. They will be omitted."),!0):(w(e)&&m("Cant add root nodes to another os."),l(e)||function n(t,e){l(e)||(t.has(e)&&m("Trying to add a node that is already added. Loops are not allowed in ORS."),y(e,function(i){n(t,e[i])}))}(this.__.getAscendancy(new Set),e),n[t]=c(e),this.__.init||this.__.setDirty(),!0)},deleteProperty:function(n,t){return delete n[t],this.__.init||this.__.setDirty(),!0},get:function(n,t){return"__"===t?this.__:d[t]?d[t]:n[t]}};const d={addChangeListener:function(n){if("function"!=typeof n)return o.warn("The listener is not a function.");this.__.clbks.push(n)},removeChangeListener:function(n){let t=this.__.clbks,e=t.length,i=!1;for(;e-- >0;)n===t[e]&&(t.splice(e,1),i=!0);i||o.warn("Couldn't find the listener to remove.")},emitChange:function(n){this.__.clbks.forEach(t=>{t(n)})},flatten:function(){return JSON.parse(JSON.stringify(this))}};function _(n){return n&&n.__}function l(n){return!(n instanceof Object)}function w(n){return n&&n.__&&n.__.rootName}function h(n){return _(n)&&n.__.dirty}function p(n){return n.splice?[]:{}}function y(n,t){n.splice&&n.forEach((n,e)=>t(e));for(let e in n)t(e,n[e])}function m(n){throw new Error("ors ERROR: "+n)}return o.warn=function(n){console.warn("ors WARNING: "+n)},o});